<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#1976d2">
  <title>FiberOMS Insight</title>

  <!-- Polyfill for Node.js globals in browser -->
  <script>
    if (typeof global === 'undefined') {
      window.global = window;
    }
  </script>

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/icons/icon.svg">
  <link rel="manifest" href="/manifest.json">

  <!-- ArcGIS Map SDK theme stylesheets -->
  <link id="esri-theme-light" rel="stylesheet" href="/assets/esri/themes/light/main.css" />
  <link id="esri-theme-dark" rel="stylesheet" href="/assets/esri/themes/dark/main.css" disabled />

  <link rel="stylesheet" href="/src/style.css">
</head>

<body>
  <div id="app">
    <!-- Calcite Shell Layout -->
    <calcite-shell>
      <!-- Header Navigation -->
      <calcite-navigation slot="header" class="unified-header">
        <calcite-navigation-logo slot="logo" heading="FiberOMS Insight" thumbnail=""></calcite-navigation-logo>
        <div slot="content-center" class="navigation-content-center">
          <div class="search-section">
            <calcite-autocomplete id="header-search"
              placeholder="Search subscribers, accounts, addresses (min 4 chars)..." scale="l" icon="search" clearable
              class="header-search-input">
              <!-- Search results will be populated here -->
            </calcite-autocomplete>
          </div>
          <div class="metrics-section">
            <calcite-chip scale="l" appearance="outline" id="metrics-chip">
              <span id="offline-count">0</span>
            </calcite-chip>
          </div>
        </div>
        <div slot="content-end" class="navigation-actions">
          <calcite-button id="refresh-dashboard" icon-start="refresh" appearance="transparent" scale="s"
            aria-label="Refresh dashboard"></calcite-button>
          <calcite-button id="theme-toggle" icon-start="brightness" appearance="transparent" scale="s"
            aria-label="Toggle theme"></calcite-button>
        </div>
      </calcite-navigation>

      <!-- Side Panel - Desktop Only -->
      <calcite-shell-panel slot="panel-start" id="layers-panel" collapsed display-mode="dock" class="desktop-only">
        <calcite-action-bar slot="action-bar">
          <calcite-action id="layers-action" text="Layers" icon="layer" active></calcite-action>
          <calcite-action id="osp-action" text="OSP (Outside Plant)" icon="utility-network"></calcite-action>
          <calcite-action id="power-outages-action" text="Power Outages" icon="flash"></calcite-action>
          <calcite-action id="search-action" text="Search" icon="search"></calcite-action>
          <calcite-action id="network-parent-action" text="Network Infrastructure" icon="linkChart"></calcite-action>
          <calcite-action id="tools-action" text="Tools" icon="apps"></calcite-action>
          <calcite-action id="info-action" text="Info" icon="information" slot="actions-end"></calcite-action>
        </calcite-action-bar>
        <calcite-panel heading="Layers" id="layers-content">
          <calcite-block heading="Subscriber Status" collapsible>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Online Subscribers
            </calcite-label>
            <calcite-label>
              <calcite-checkbox checked></calcite-checkbox>
              Offline Subscribers
            </calcite-label>
            <div class="block-actions">
              <calcite-button id="refresh-data" icon-start="refresh" scale="s" width="full">
                Refresh Data
              </calcite-button>
              <!-- Test button for development -->
              <calcite-button id="test-subscriber-update" icon-start="information" scale="s" width="full"
                appearance="outline" style="margin-top: 8px; display: none;">
                Test Subscriber Toast
              </calcite-button>
            </div>
          </calcite-block>

          <calcite-block heading="Fiber Outages" collapsible>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Fiber Network Outages
            </calcite-label>
          </calcite-block>
          <calcite-block heading="Vehicle Tracking" collapsible>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Electric Trucks
            </calcite-label>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Fiber Trucks
            </calcite-label>
          </calcite-block>
        </calcite-panel>
        <calcite-panel heading="OSP (Outside Plant)" id="osp-content" hidden>
          <calcite-block heading="OSP (Outside Plant)" collapsible>
            <calcite-icon slot="icon" icon="utility-network"></calcite-icon>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              FSA Boundaries
            </calcite-label>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Main Line Fiber
            </calcite-label>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Main Line Old
            </calcite-label>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              MST Terminals
            </calcite-label>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              MST Fiber
            </calcite-label>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Splitters
            </calcite-label>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Closures
            </calcite-label>
          </calcite-block>
        </calcite-panel>
        <calcite-panel heading="Power Outages" id="power-outages-content" hidden>
          <calcite-block heading="Power Outages" collapsible expanded>
            <calcite-icon slot="icon" icon="flash"></calcite-icon>

            <!-- Power Outage Statistics -->
            <power-outage-stats id="power-outage-stats"></power-outage-stats>

            <div class="block-actions">
              <calcite-button id="refresh-power-outages" icon-start="refresh" scale="s" width="full">
                Refresh Power Outages
              </calcite-button>
              <!-- Test button for development -->
              <calcite-button id="test-outage-update" icon-start="information" scale="s" width="full"
                appearance="outline" style="margin-top: 8px; display: none;">
                Test Update Toast
              </calcite-button>
            </div>
          </calcite-block>
        </calcite-panel>
        <calcite-panel heading="Search" id="search-content" hidden>
          <calcite-block heading="MFS Database Search">
            <calcite-autocomplete id="desktop-search" placeholder="Search addresses, customers, accounts..."
              icon="search" clearable scale="m">
              <!-- Search results will be populated here -->
            </calcite-autocomplete>
            <calcite-button width="full" appearance="solid" scale="s"
              style="margin-top: var(--calcite-spacing-sm);">Advanced Search</calcite-button>
          </calcite-block>
        </calcite-panel>
        <calcite-panel heading="Network Infrastructure" id="network-parent-content" hidden>
          <calcite-block heading="Node Sites" collapsible>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Node Sites
            </calcite-label>
          </calcite-block>
        </calcite-panel>
        <calcite-panel heading="Tools" id="tools-content" hidden>
          <calcite-block heading="Weather Overlays" collapsible>
            <calcite-label>
              <calcite-checkbox></calcite-checkbox>
              Weather Radar
            </calcite-label>
          </calcite-block>
          <calcite-block heading="Sketch Tools" collapsible>
            <calcite-button width="full" icon-start="polygon" scale="s">Draw Outage Area</calcite-button>
            <calcite-button width="full" icon-start="download" scale="s">Export CSV</calcite-button>
          </calcite-block>
          <calcite-block heading="Offline Data Cache" collapsible>
            <div id="cache-status" style="padding: 12px;">
              <calcite-list selection-mode="none">
                <calcite-list-item label="Cache Status" description="Loading cache information...">
                  <calcite-icon slot="content-start" icon="data"></calcite-icon>
                  <span slot="content-end" id="cache-size-text" style="color: var(--calcite-color-text-2);">--</span>
                </calcite-list-item>
              </calcite-list>
              <div id="cache-details" style="margin-top: 12px;"></div>
              <div style="margin-top: 12px; display: flex; gap: 8px;">
                <calcite-button width="full" appearance="outline" icon-start="refresh" scale="s"
                  id="refresh-cache-btn">Refresh Cache Info</calcite-button>
                <calcite-button width="full" appearance="outline-fill" kind="danger" icon-start="trash" scale="s"
                  id="clear-cache-btn">Clear All Cache</calcite-button>
              </div>
            </div>
          </calcite-block>
        </calcite-panel>

        <!-- Info Panel -->
        <calcite-panel heading="Information" id="info-content" hidden>
          <calcite-block heading="App Details" expanded>
            <div id="app-info" style="padding: 12px;">
              <calcite-list selection-mode="none">
                <calcite-list-item label="Build Version" id="build-version-item">
                  <calcite-icon slot="content-start" icon="code"></calcite-icon>
                  <span slot="content-end" id="build-version-text"
                    style="font-family: monospace; color: var(--calcite-color-text-2);">Loading...</span>
                </calcite-list-item>
                <calcite-list-item label="Last Updated" id="build-date-item">
                  <calcite-icon slot="content-start" icon="clock"></calcite-icon>
                  <span slot="content-end" id="build-date-text"
                    style="color: var(--calcite-color-text-2);">Loading...</span>
                </calcite-list-item>
                <calcite-list-item label="Environment" id="environment-item">
                  <calcite-icon slot="content-start" icon="globe"></calcite-icon>
                  <span slot="content-end" id="environment-text"
                    style="color: var(--calcite-color-text-2);">Loading...</span>
                </calcite-list-item>
              </calcite-list>
            </div>
          </calcite-block>

          <calcite-block heading="Resources" collapsible>
            <calcite-list selection-mode="none">
              <calcite-list-item label="Documentation" description="View application documentation">
                <calcite-icon slot="content-start" icon="fileText"></calcite-icon>
                <calcite-action slot="actions-end" icon="launch" id="docs-link"></calcite-action>
              </calcite-list-item>
              <calcite-list-item label="Report Issue" description="Submit bug reports or feedback">
                <calcite-icon slot="content-start" icon="exclamation-mark-triangle"></calcite-icon>
                <calcite-action slot="actions-end" icon="launch" id="issue-link"></calcite-action>
              </calcite-list-item>
            </calcite-list>
          </calcite-block>
        </calcite-panel>
      </calcite-shell-panel>

      <!-- Main Content Area -->
      <div class="map-container">
        <arcgis-map id="map" basemap="streets-navigation-vector" theme="light">
          <arcgis-search position="top-left" theme="light"></arcgis-search>
          <arcgis-track position="top-left" theme="light"></arcgis-track>
          <arcgis-home position="top-left" theme="light"></arcgis-home>
          <arcgis-locate position="top-left" theme="light"></arcgis-locate>
          <arcgis-basemap-toggle position="bottom-right" next-basemap="satellite" theme="light"></arcgis-basemap-toggle>
          <arcgis-expand position="top-left" theme="light" icon="basemap" tooltip="Basemap Gallery">
            <arcgis-basemap-gallery theme="light"></arcgis-basemap-gallery>
          </arcgis-expand>
          <arcgis-fullscreen position="top-left" theme="light"></arcgis-fullscreen>
        </arcgis-map>
      </div>

      <!-- Mobile Close Button - shows when panels are open -->
      <calcite-button id="mobile-close-button" class="mobile-only" width="full" appearance="outline" scale="l"
        icon-start="x">
        Close Panel
      </calcite-button>

      <!-- Mobile Bottom Navigation -->
      <calcite-segmented-control id="mobile-tab-bar" class="mobile-only" width="full" appearance="outline" scale="l">
        <calcite-segmented-control-item id="tab-search" value="search"
          icon-start="search"></calcite-segmented-control-item>
        <calcite-segmented-control-item id="tab-subscribers" value="subscribers"
          icon-start="users"></calcite-segmented-control-item>
        <calcite-segmented-control-item id="tab-osp" value="osp"
          icon-start="link-chart"></calcite-segmented-control-item>
        <calcite-segmented-control-item id="tab-vehicles" value="vehicles"
          icon-start="car"></calcite-segmented-control-item>
        <calcite-segmented-control-item id="tab-power" value="power"
          icon-start="flash"></calcite-segmented-control-item>
        <calcite-segmented-control-item id="tab-other" value="other" icon-start="apps"></calcite-segmented-control-item>
      </calcite-segmented-control>
    </calcite-shell>


    <!-- Mobile Bottom Modals -->

    <!-- Search Modal -->
    <calcite-dialog id="mobile-search-sheet" class="mobile-only" width-scale="l" scale="l">
      <div slot="header" class="dialog-header">
        <span class="dialog-title">Search</span>
        <calcite-button appearance="transparent" kind="neutral" scale="s" icon-start="x" class="dialog-close-btn"
          aria-label="Close"></calcite-button>
      </div>
      <div slot="content">
        <calcite-block heading="Quick Search" expanded>
          <calcite-input id="mobile-search-input" type="search" placeholder="Search addresses, customers, accounts..."
            icon="search" scale="l" clearable>
          </calcite-input>
        </calcite-block>

        <calcite-block heading="Recent Searches" expanded>
          <!-- Recent searches will be populated dynamically -->
        </calcite-block>


      </div>
    </calcite-dialog>

    <calcite-dialog id="mobile-subscribers-sheet" class="mobile-only" width-scale="l" scale="l">
      <div slot="header" class="dialog-header">
        <span class="dialog-title">Subscribers</span>
        <calcite-button appearance="transparent" kind="neutral" scale="s" icon-start="x" class="dialog-close-btn"
          aria-label="Close"></calcite-button>
      </div>
      <div slot="content">
        <calcite-block heading="Subscriber Status" expanded>
          <calcite-list-item label="Online Subscribers" description="Show active subscribers" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="circle"
              style="color: var(--calcite-color-status-success);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="Offline Subscribers" description="Show disconnected subscribers"
            class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="circle"
              style="color: var(--calcite-color-status-danger);"></calcite-icon>
            <calcite-switch slot="content-end" checked></calcite-switch>
          </calcite-list-item>
        </calcite-block>

        <calcite-block heading="Tools" expanded>
          <calcite-button width="full" icon-start="refresh" appearance="outline" id="refresh-subscriber-data">Refresh
            Data</calcite-button>
          <calcite-button width="full" icon-start="download" appearance="outline">Export Offline CSV</calcite-button>
        </calcite-block>
      </div>
    </calcite-dialog>

    <calcite-dialog id="mobile-osp-sheet" class="mobile-only" width-scale="l" scale="l">
      <div slot="header" class="dialog-header">
        <span class="dialog-title">OSP Infrastructure</span>
        <calcite-button appearance="transparent" kind="neutral" scale="s" icon-start="x" class="dialog-close-btn"
          aria-label="Close"></calcite-button>
      </div>
      <div slot="content">
        <calcite-block heading="Network Infrastructure" expanded>
          <calcite-list-item label="Node Sites" description="Network node locations" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="circle" style="color: var(--calcite-color-info);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>
        </calcite-block>

        <calcite-block heading="OSP (Outside Plant)" expanded>
          <calcite-list-item label="FSA Boundaries" description="Service area boundaries" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="polygon" style="color: rgb(30, 144, 255);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="Main Line Fiber" description="Primary fiber routes" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="line" style="color: rgb(165, 42, 42);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="Main Line Old" description="Legacy fiber infrastructure" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="line" style="color: rgb(105, 105, 105);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="MST Terminals" description="Multi-service terminals" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="circle" style="color: rgb(0, 191, 255);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="MST Fiber" description="MST fiber connections" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="line" style="color: rgb(75, 0, 130);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="Splitters" description="Optical splitters" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="diamond" style="color: rgb(128, 0, 128);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="Closures" description="Fiber splice closures" class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="square" style="color: rgb(255, 140, 0);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>
        </calcite-block>



        <calcite-block heading="Fiber Outages" expanded>
          <calcite-list-item label="Fiber Network Outages" description="Current fiber outages"
            class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="exclamationMarkTriangle"
              style="color: var(--calcite-color-status-danger);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>
        </calcite-block>

        <calcite-block heading="Tools" expanded>
          <calcite-button width="full" icon-start="polygon" appearance="outline">Draw Outage Area</calcite-button>
          <calcite-button width="full" icon-start="rain" appearance="outline" id="mobile-radar-toggle">Weather
            Radar</calcite-button>
        </calcite-block>
      </div>
    </calcite-dialog>

    <calcite-dialog id="mobile-vehicles-sheet" class="mobile-only" width-scale="l" scale="l">
      <div slot="header" class="dialog-header">
        <span class="dialog-title">Vehicle Tracking</span>
        <calcite-button appearance="transparent" kind="neutral" scale="s" icon-start="x" class="dialog-close-btn"
          aria-label="Close"></calcite-button>
      </div>
      <div slot="content">
        <calcite-block heading="Vehicle Tracking" expanded>
          <calcite-list-item label="Electric Trucks" description="Track electric maintenance fleet"
            class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="flash" style="color: rgb(74, 124, 89);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>

          <calcite-list-item label="Fiber Trucks" description="Track fiber installation fleet"
            class="layer-toggle-item">
            <calcite-icon slot="content-start" icon="car" style="color: rgb(30, 95, 175);"></calcite-icon>
            <calcite-switch slot="content-end"></calcite-switch>
          </calcite-list-item>
        </calcite-block>

        <calcite-block heading="Tools" expanded>
          <calcite-button width="full" icon-start="refresh" appearance="outline">Refresh Vehicle
            Locations</calcite-button>
          <calcite-button width="full" icon-start="information" appearance="outline">Vehicle Details</calcite-button>
        </calcite-block>
      </div>
    </calcite-dialog>

    <calcite-dialog id="mobile-power-sheet" class="mobile-only" width-scale="l" scale="l">
      <div slot="header" class="dialog-header">
        <span class="dialog-title">Power Outages</span>
        <calcite-button appearance="transparent" kind="neutral" scale="s" icon-start="x" class="dialog-close-btn"
          aria-label="Close"></calcite-button>
      </div>
      <div slot="content">
        <!-- Power Outage Stats Component -->
        <power-outage-stats id="mobile-power-stats"></power-outage-stats>
      </div>
    </calcite-dialog>

    <calcite-dialog id="mobile-other-sheet" class="mobile-only" width-scale="l" scale="l">
      <div slot="header" class="dialog-header">
        <span class="dialog-title">Tools & Info</span>
        <calcite-button appearance="transparent" kind="neutral" scale="s" icon-start="x" class="dialog-close-btn"
          aria-label="Close"></calcite-button>
      </div>
      <div slot="content">
        <calcite-block heading="Environmental" expanded>
          <calcite-list selection-mode="none">
            <calcite-list-item label="Weather Radar" description="Live weather overlay from RainViewer"
              class="layer-toggle-item">
              <calcite-icon slot="content-start" icon="rain" style="color: var(--calcite-color-info);"></calcite-icon>
              <calcite-switch slot="content-end"></calcite-switch>
            </calcite-list-item>
          </calcite-list>
        </calcite-block>

        <calcite-block heading="Sketch Tools" expanded>
          <calcite-button width="full" icon-start="polygon" appearance="outline">Draw Outage Area</calcite-button>
          <calcite-button width="full" icon-start="download" appearance="outline">Export CSV</calcite-button>
        </calcite-block>

        <calcite-block heading="Offline Data Cache" expanded>
          <div id="mobile-cache-status" style="padding: 12px;">
            <calcite-list selection-mode="none">
              <calcite-list-item label="Cache Status" description="Loading cache information...">
                <calcite-icon slot="content-start" icon="data"></calcite-icon>
                <span slot="content-end" id="mobile-cache-size-text"
                  style="color: var(--calcite-color-text-2);">--</span>
              </calcite-list-item>
            </calcite-list>
            <div id="mobile-cache-details" style="margin-top: 12px;"></div>
            <div style="margin-top: 12px; display: flex; gap: 8px;">
              <calcite-button width="full" appearance="outline" icon-start="refresh" scale="s"
                id="mobile-refresh-cache-btn">Refresh Cache</calcite-button>
              <calcite-button width="full" appearance="outline-fill" kind="danger" icon-start="trash" scale="s"
                id="mobile-clear-cache-btn">Clear Cache</calcite-button>
            </div>
          </div>
        </calcite-block>

        <calcite-block heading="App Details" expanded>
          <div id="mobile-app-info" style="padding: 12px;">
            <calcite-list selection-mode="none">
              <calcite-list-item label="Build Version" id="mobile-build-version-item">
                <calcite-icon slot="content-start" icon="code"></calcite-icon>
                <span slot="content-end" id="mobile-build-version-text"
                  style="font-family: monospace; color: var(--calcite-color-text-2);">Loading...</span>
              </calcite-list-item>
              <calcite-list-item label="Last Updated" id="mobile-build-date-item">
                <calcite-icon slot="content-start" icon="clock"></calcite-icon>
                <span slot="content-end" id="mobile-build-date-text"
                  style="color: var(--calcite-color-text-2);">Loading...</span>
              </calcite-list-item>
              <calcite-list-item label="Environment" id="mobile-environment-item">
                <calcite-icon slot="content-start" icon="globe"></calcite-icon>
                <span slot="content-end" id="mobile-environment-text"
                  style="color: var(--calcite-color-text-2);">Loading...</span>
              </calcite-list-item>
            </calcite-list>
          </div>
        </calcite-block>

        <calcite-block heading="Resources" expanded>
          <calcite-list selection-mode="none">
            <calcite-list-item label="Documentation" description="View application documentation">
              <calcite-icon slot="content-start" icon="fileText"></calcite-icon>
              <calcite-action slot="actions-end" icon="launch" id="mobile-docs-link"></calcite-action>
            </calcite-list-item>
            <calcite-list-item label="Report Issue" description="Submit bug reports or feedback">
              <calcite-icon slot="content-start" icon="exclamation-mark-triangle"></calcite-icon>
              <calcite-action slot="actions-end" icon="launch" id="mobile-issue-link"></calcite-action>
            </calcite-list-item>
          </calcite-list>
        </calcite-block>

      </div>
    </calcite-dialog>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>

</html>